<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameHub - Home</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <h1>üéÆ GameHub</h1>
        <div class="user-info">
            <span class="username" id="displayUsername">Loading...</span>
            <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>
    </nav>

    <div class="main-content">
        <div class="welcome-section">
            <h2>Welcome to GameHub!</h2>
            <p>Choose a game and start playing</p>
        </div>

        <div class="pixel-decorations">
            <img src="tree.png" class="pixel-sprite tree" />
            <img src="tree.png" class="pixel-sprite tree" />
            <img src="flower.png" class="pixel-sprite flower" />
            <img src="flower.png" class="pixel-sprite flower" />
        </div>
        
        <div class="games-grid">
            <div class="game-card" onclick="window.location.href='games/tictactoe.html'">
                <div class="game-icon">‚≠ï</div>
                <h3>Tic Tac Toe</h3>
                <p>Classic strategy game for two players</p>
                <button class="play-btn">Play Now</button>
            </div>

            <div class="game-card" onclick="window.location.href='games/memory.html'">
                <div class="game-icon">üß†</div>
                <h3>Memory Game</h3>
                <p>Test your memory skills</p>
                <button class="play-btn">Play Now</button>
            </div>

            <div class="game-card" onclick="window.location.href='games/snake.html'">
                <div class="game-icon">üêç</div>
                <h3>Snake Game</h3>
                <p>Classic snake arcade game</p>
                <button class="play-btn">Play Now</button>
            </div>

            <div class="game-card" onclick="window.location.href='games/quiz.html'">
                <div class="game-icon">‚ùì</div>
                <h3>Quiz Game</h3>
                <p>Challenge your knowledge</p>
                <button class="play-btn">Play Now</button>
            </div>

            <div class="game-card" onclick="window.location.href='games/number-guess.html'">
                <div class="game-icon">üî¢</div>
                <h3>Number Guessing</h3>
                <p>Guess the secret number</p>
                <button class="play-btn">Play Now</button>
            </div>

            <div class="game-card" onclick="window.location.href='games/rock-paper.html'">
                <div class="game-icon">‚úä</div>
                <h3>Rock Paper Scissors</h3>
                <p>Play against the computer</p>
                <button class="play-btn">Play Now</button>
            </div>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // Your Supabase configuration (SAME AS index.html)
        const SUPABASE_URL = 'https://rahgvtfmencxhomiwfhk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJhaGd2dGZtZW5jeGhvbWl3ZmhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTM0MjYsImV4cCI6MjA3OTQ2OTQyNn0.coRX7n9zIkwYSbx8zl6vg9PjMrJC50tt2CH-sIsJD04';

        // Initialize Supabase
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Check if user is logged in
        const checkAuth = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
                // No user is logged in, redirect to login page
                window.location.href = 'index.html';
                return;
            }

            // User is logged in, fetch and display username
            try {
                const { data: userData, error } = await supabase
                    .from('users')
                    .select('username')
                    .eq('id', session.user.id)
                    .single();

                if (error) throw error;

                const displayUsername = document.getElementById('displayUsername');
                displayUsername.textContent = userData.username || session.user.email;
            } catch (error) {
                console.error('Error fetching user data:', error);
                document.getElementById('displayUsername').textContent = session.user.email;
            }
        };

        // Call checkAuth on page load
        checkAuth();

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                alert('Error logging out. Please try again.');
            }
        });

        // Track game plays (can be called from individual game pages)
        window.trackGamePlay = async function() {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (session) {
                try {
                    const { error } = await supabase.rpc('increment_games_played', {
                        user_id: session.user.id
                    });
                    
                    if (error) {
                        // If RPC doesn't exist, use regular update
                        const { data: currentData } = await supabase
                            .from('users')
                            .select('games_played')
                            .eq('id', session.user.id)
                            .single();
                        
                        await supabase
                            .from('users')
                            .update({ games_played: (currentData.games_played || 0) + 1 })
                            .eq('id', session.user.id);
                    }
                } catch (error) {
                    console.error('Error tracking game play:', error);
                }
            }
        };
    </script>
</body>
</html>