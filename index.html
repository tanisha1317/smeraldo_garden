<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameHub - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="form-container">
            <div class="form-toggle">
                <button class="toggle-btn active" id="loginToggle">Login</button>
                <button class="toggle-btn" id="registerToggle">Register</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="form active">
                <h2>Welcome Back!</h2>
                <div class="input-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="submit-btn">Login</button>
                <div id="loginError" class="error-message"></div>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="form">
                <h2>Create Account</h2>
                <div class="input-group">
                    <label for="registerUsername">Username</label>
                    <input type="text" id="registerUsername" required>
                </div>
                <div class="input-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="input-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="input-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" required minlength="6">
                </div>
                <button type="submit" class="submit-btn">Register</button>
                <div id="registerError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // Your Supabase configuration
        // REPLACE THESE WITH YOUR ACTUAL SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://rahgvtfmencxhomiwfhk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJhaGd2dGZtZW5jeGhvbWl3ZmhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTM0MjYsImV4cCI6MjA3OTQ2OTQyNn0.coRX7n9zIkwYSbx8zl6vg9PjMrJC50tt2CH-sIsJD04';

        // Initialize Supabase
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Toggle between login and register forms
        const loginToggle = document.getElementById('loginToggle');
        const registerToggle = document.getElementById('registerToggle');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        loginToggle.addEventListener('click', () => {
            loginToggle.classList.add('active');
            registerToggle.classList.remove('active');
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
        });

        registerToggle.addEventListener('click', () => {
            registerToggle.classList.add('active');
            loginToggle.classList.remove('active');
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
        });

        // Register functionality
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('registerError');

            // Clear previous errors
            errorDiv.classList.remove('show');
            errorDiv.textContent = '';

            // Validate passwords match
            if (password !== confirmPassword) {
                errorDiv.textContent = 'Passwords do not match!';
                errorDiv.classList.add('show');
                return;
            }

            try {
                // Sign up user
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            username: username
                        }
                    }
                });

                if (authError) throw authError;

                // Insert user data into users table
                const { error: dbError } = await supabase
                    .from('users')
                    .insert([
                        {
                            id: authData.user.id,
                            username: username,
                            email: email,
                            games_played: 0
                        }
                    ]);

                if (dbError) throw dbError;

                // Success - redirect to homepage
                alert('Registration successful! Please check your email to verify your account (if email confirmation is enabled).');
                window.location.href = 'homepage.html';
            } catch (error) {
                console.error('Registration error:', error);
                errorDiv.textContent = error.message || 'Registration failed. Please try again.';
                errorDiv.classList.add('show');
            }
        });

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            // Clear previous errors
            errorDiv.classList.remove('show');
            errorDiv.textContent = '';

            try {
                // Sign in user
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                // Redirect to homepage
                window.location.href = 'homepage.html';
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'Invalid email or password!';
                errorDiv.classList.add('show');
            }
        });

        // Check if user is already logged in
        supabase.auth.onAuthStateChange((event, session) => {
            if (session) {
                // User is logged in, redirect to homepage
                window.location.href = 'homepage.html';
            }
        });
    </script>
</body>
</html>